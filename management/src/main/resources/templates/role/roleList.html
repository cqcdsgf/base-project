<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>权限列表</title>
    <link rel="stylesheet" href="../../static/plugin/bootstrap-3.3.7/css/bootstrap.min.css"
          th:href="@{/plugin/bootstrap-3.3.7/css/bootstrap.min.css}"/>

    <script type="text/javascript" src="../../static/plugin/jquery-1.12.4/jquery-1.12.4.min.js"
            th:src="@{/plugin/jquery-1.12.4/jquery-1.12.4.min.js}"></script>
    <script type="text/javascript" src="../../static/plugin/jquery-validation-1.17.0/jquery.validate.js"
            th:src="@{/plugin/jquery-validation-1.17.0/jquery.validate.js}"></script>
    <script type="text/javascript" src="../../static/plugin/bootstrap-3.3.7/js/bootstrap.js"
            th:src="@{/plugin/bootstrap-3.3.7/js/bootstrap.js}"></script>

</head>
<body>
<div class="container">
    <div th:replace="/layout/header :: header"></div>
    <div th:replace="/layout/sidebar :: sidebar"></div>

    <div class="row">
        <a th:href="@{/role/toCreate}">创建权限</a>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <table class="table table-striped table-hover">
                    <thead class="panel-heading">
                    <tr>
                        <th>ID</th>
                        <th>角色名称</th>
                        <th>摘要</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="role,roleStat:${roles}">
                        <td th:name="roleId" th:text="${role.id}"></td>
                        <td th:text="${role.name}"></td>
                        <td th:text="${role.summary}"></td>
                        <td>
                            <a th:href="@{/role/toUpdate(id=${role.id})}">修改</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-md-6">
            <div class="panel panel-default">
                <table id="permissionsTable" class="table table-striped table-hover">
                    <thead class="panel-heading">
                    <tr>
                        <th>ID</th>
                        <th>权限名称</th>
                        <th>摘要</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    $(function () {
        $('.table tbody tr').on('click', function () {
            var id = $(this).find("[name='roleId']").text();

            getPermissions(id);
        });
    })

    function getPermissions(id) {
        $( '#permissionsTable tbody' ).empty();
        var url = '/role/getPermissions?id=' + id;
        $.get( url, function( json ) {
            if( null != json ) {
                $( json ).each( function( i, n ) {
                    var el = '<tr">';
                    if( n.selected ) {
                        el += '<td><input type="checkbox" name="roleIds" checked="checked" value="' + n.id + '" /></td>';
                    } else {
                        el += '<th><input type="checkbox" name="roleIds" value="' + n.id + '" /></th>';
                    }
                    el += '<td>' + n.name + '</td>';
                    el += '<td>' + n.summary + '</td>';
                    el += '</tr>';

                    $( '#permissionsTable tbody' ).append( el );
                } );
            }
        }, 'json' );
    }

</script>

</div>
</body>
</html>